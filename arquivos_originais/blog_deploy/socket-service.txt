## FONTE:
## https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-18-04

# Criando o arquivo
sudo nano /etc/systemd/system/gunicorn_blog.socket
##################################################

# COLAR (SEM EDIÇÃO)
[Unit]
Description=gunicorn_blog socket

[Socket]
ListenStream=/run/gunicorn_blog.sock

[Install]
WantedBy=sockets.target
##################################################

# Criando outro arquivo
sudo nano /etc/systemd/system/gunicorn_blog.service
##################################################

# Editar, depois Colar
[Unit]
Description=gunicorn_blog daemon
Requires=gunicorn_blog.socket
After=network.target

[Service]
User=rafaelcalassara
Group=www-data
WorkingDirectory=/home/rafaelcalassara/blog
ExecStart=/home/rafaelcalassara/blog/venv/bin/gunicorn \
          --access-logfile - \
          --workers 3 \
          --bind unix:/run/gunicorn_blog.sock \
          blog.wsgi:application

[Install]
WantedBy=multi-user.target
##################################################

# Ativando
sudo systemctl start gunicorn_blog.socket
sudo systemctl enable gunicorn_blog.socket
##################################################

# Checando
sudo systemctl status gunicorn_blog.socket
sudo systemctl status gunicorn_blog
curl --unix-socket /run/gunicorn_blog.sock localhost
sudo systemctl status gunicorn_blog
##################################################

sudo nano /etc/nginx/sites-enabled/sitedjango
##################################################

sudo rm /etc/nginx/sites-enabled/default
sudo systemctl restart nginx
sudo systemctl restart gunicorn_blog
##################################################
